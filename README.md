# 心灵树洞

一个专注于陪伴和情绪表达的前端应用，提供拟真的「树洞」互动体验。用户可以在树干上创建多个私密树洞，记录心情、上传图片、回顾历史，并通过本地存储与可选的云端备份守护自己的故事。

## 目录

- [项目简介](#项目简介)
- [核心特性](#核心特性)
- [技术栈](#技术栈)
- [快速开始](#快速开始)
- [项目结构](#项目结构)
- [Supabase 云端同步配置](#supabase-云端同步配置)
- [AI 与分类逻辑](#ai-与分类逻辑)
- [开发与自定义建议](#开发与自定义建议)
- [许可证](#许可证)

## 项目简介

「心灵树洞」是一个完全运行在浏览器端的单页应用。页面以动态树干作为核心视觉，用户可以在不同树洞中写下自己的心事，或邀请朋友一起维护共同的树洞。

应用支持本地离线使用，所有内容默认保存在浏览器 LocalStorage 中；如需跨设备同步，可连接 Supabase 完成云备份与恢复。

## 核心特性

- **多树洞管理**：可在树干上创建多个树洞，每个树洞拥有独立的消息流与创建时间。【app.js】
- **密码守护**：树洞支持 4 位数 PIN 码加锁，保护隐私内容。【app.js】
- **情绪与主题分类**：根据关键词对消息进行情绪和内容类型的判别，便于后续过滤与检索。【app.js】
- **AI 陪伴式回复**：根据用户的输入内容生成温柔的安慰话语，在树洞中提供轻量陪伴体验。【app.js】
- **图片留言与预览**：支持上传图片，自动生成本地预览并按消息一起保存。【app.js】
- **搜索与过滤**：内置搜索、情绪筛选与主题筛选，帮助快速定位历史留言。【app.js】
- **云端同步（可选）**：集成 Supabase 认证与 JSON 备份，随时备份或恢复树洞数据。【app.js】
- **响应式体验**：使用现代 CSS，兼顾移动端与桌面端的操作体验。【styles.css】

## 技术栈

- **语言**：原生 HTML、CSS、JavaScript（ES Modules）。
- **数据存储**：浏览器 LocalStorage；可选 Supabase Postgres JSON 字段。
- **外部服务**：[@supabase/supabase-js](https://supabase.com/) CDN 版本。

## 快速开始

1. 克隆或下载本仓库。
2. 使用任意静态资源服务器打开 `index.html` 即可体验：
   ```bash
   # 方式一：直接双击 index.html，在浏览器中打开

   # 方式二：使用 Node.js 环境启动临时静态服务器
   npx serve .
   # 或者
   python -m http.server 4173
   ```
3. 浏览器会自动加载 `app.js`，首次进入可创建新的树洞并开始记录。

> **提示**：建议使用现代浏览器（Chrome、Edge、Firefox、Safari 等）。如需在移动端添加到主屏幕，可通过浏览器的「添加到主屏幕」功能实现近似原生的体验。

## 项目结构

```
.
├── index.html   # 应用入口，挂载根节点并加载脚本
├── styles.css   # 全局样式与视觉布局
└── app.js       # 业务逻辑、状态管理、UI 渲染与 Supabase 集成
```

## Supabase 云端同步配置

若希望跨设备共享或备份树洞数据，可在应用右上角打开「云端同步」入口，按照以下步骤配置：

1. **准备项目**：在 Supabase 控制台创建新项目，记录项目 URL 与 `anon` 公钥。
2. **创建数据表**：在 Supabase SQL 编辑器执行下方语句（与应用内提示一致）：
   ```sql
   create table if not exists tree_holes_backups (
     user_id uuid primary key references auth.users,
     data jsonb not null,
     updated_at timestamptz default now()
   );
   ```
3. **填写配置**：在弹窗中输入 Supabase URL 与匿名密钥，点击「保存配置」。
4. **登录/注册**：使用邮箱密码在 Supabase Auth 中登录或注册账号。
5. **开始同步**：登录后即可手动「立即备份」或「从云端恢复」，应用会展示最近一次同步时间与云端快照信息。

> **安全提示**：Supabase 匿名密钥仍具备写入权限，请妥善保管，不要在公共环境泄露。

## AI 与分类逻辑

- 当检测到打招呼语句或仅上传图片时，会返回更贴合场景的安慰话语，让回复显得更贴心。【app.js】
- 通过关键词匹配快速判断情绪（如「开心」「难过」）与主题类型（工作、学习、感情等），未命中时归类为「其他」。【app.js】
- 图片留言在分类上会标记为「图片」，同时保留文字内容供搜索使用。【app.js】

## 开发与自定义建议

- 可以在 `comfortingPhrases`、`greetingKeywords` 等数组中追加自定义语料，打造更符合团队/个人风格的陪伴语句。【app.js】
- 若要接入真实的 AI 服务，可在 `getComfortingReply` 中调用第三方 API，再根据需求处理异常与限流逻辑。【app.js】
- 需要替换主题色或字体时，可直接修改 `styles.css` 中的 CSS 变量与字体定义。【styles.css】
- 如计划发布为 PWA，可在根目录新增 manifest、service worker 并配置缓存策略，以支持离线访问和安装体验。

## 许可证

本项目尚未指定开源许可证，默认保留所有权利。如需在其他项目中使用，请先与作者确认或补充 LICENSE 文件。
